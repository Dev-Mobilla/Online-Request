@model OnlineRequestSystem.Models.OpenReqInfo
@{
    ViewBag.Title = "ViewOpenRequest";
    var mySession = (OnlineRequestSystem.Models.ORSession)Session["UserSession"];

    var ORHeading = string.Empty;

    if (Model.POurl == "PO")
    {
        ORHeading = "ORSHeadingPO";
    }
    else
    {
        ORHeading = "ORSHeading";
    }
}
<br />

<div id="openBody" class="jumbotron boxShadow col-md-12" style="width:1300px;margin-left:-4.5%; padding-left:0px; padding-right:0px">
    <div class="panel-heading @ORHeading">
        <b class="orHeader">@ViewBag.headTxt REQUESTS</b>
        @if ((new[] { "0001MMD", "0002MMD", }).Contains(mySession.s_costcenter))
        {
            <div class="pull-right" style="color:black;">
                <button class="mmdLoad" onclick="location.href='@Url.Action("viewMMDStatus", "MMD", new { selected = "PROCESSED PO", retUrl = Model.returnUrl, office = Model.office })'"><i> Processed PO </i></button>
                <button class="mmdLoad" onclick="location.href='@Url.Action("viewMMDStatus", "MMD", new { selected = "RECEIVED FROM SUPPLIER", retUrl = Model.returnUrl, office = Model.office })'"><i> Received from supplier </i></button>
                <button class="mmdLoad" onclick="location.href='@Url.Action("viewMMDStatus", "MMD", new { selected = "IN TRANSIT-SDC", retUrl = Model.returnUrl, office = Model.office })'"><i> In-Transit </i></button>
            </div>
        }
    </div>
    @if (mySession.s_isDepartmentApprover == 1)
    {
        @Html.Partial("OpenReqPartials/_DepartmentManager", Model);
    }
    else if (mySession.s_job_title == "AREA MANAGER")
    {
        @Html.Partial("OpenReqPartials/_AreaManager", Model);
    }
    else if (mySession.s_job_title == "REGIONAL MAN")
    {
        @Html.Partial("OpenReqPartials/_RegionalManager", Model);
    }
    else if (mySession.s_usr_id == "LHUI1011873")
    {
        @Html.Partial("OpenReqPartials/_President", Model);
    }
    else
    {
        if (mySession.s_isDepartmentApprover != 1)
        {
            <div style="padding-top:7px;"></div>
            <table class="table-hover" id="BMorOthers">
                <thead>
                    <tr>
                        <th style="text-align:center">Select</th>
                        <th class="col-sm-1" style="text-align:center">Date Created</th>
                        <th class="col-sm-2" style="text-align:center">Request no.</th>
                        <th class="col-sm-2" style="text-align:center">Type</th>
                        <th class="col-sm-1" style="text-align:center">Count</th>
                        <th class="col-sm-2" style="text-align:center">Description</th>
                        <th class="col-sm-2" style="text-align:center">Branch/Division</th>
                        <th class="col-sm-2" style="text-align:center">Author</th>
                        <th class="col-sm-2" style="text-align:center">Region</th>
                    </tr>
                </thead>
                <tbody style="font-size:12px;" id="tbodys">
                    @if (Model._OpenInfo != null)
                    {
                        foreach (var item in Model._OpenInfo)
                        {
                            if (item.reqCreator == mySession.s_fullname && item.reqStatus == "OPEN")
                            {
                                <tr class="cellspacer" style="cursor:pointer;">
                                    <td style="text-align:center"><button class="btn btn-sm btn-danger" onclick="location.href = '@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber , BranchCode = item.BranchCode , ZoneCode = @item.ZoneCode , Region = @item.Region })'">Show Details</button></td>
                                    <td style="text-align:center">@item.reqDate</td>
                                    <td style="text-align:center">@item.reqNumber</td>
                                    <td style="text-align:center">@item.TypeName</td>
                                    <td style="text-align:center">@item.TotalItems</td>
                                    <td style="text-align:center">@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</td>
                                    <td style="text-align:center">@item.BranchName</td>
                                    <td style="text-align:center">@item.reqCreator</td>
                                    <td style="text-align:center">
                                            @item.Region
                                            <span id="bcode" style="display:none;">@item.BranchCode</span>
                                    </td>
                                </tr>
                            }
                        }
                    }
                </tbody>
            </table>
        }
    }
</div>
@section tableCss{
    <link href="~/Content/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/datetime/1.2.0/css/dataTables.dateTime.min.css" rel="stylesheet" />
}

@section scripts{

    <script type="text/javascript" src="//cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.2/moment.min.js"></script>
    <script type="text/javascript" src="//cdn.datatables.net/datetime/1.3.0/js/dataTables.dateTime.min.js"></script>
    <script type="text/javascript" src="//cdn.datatables.net/plug-ins/1.13.3/sorting/datetime-moment.js"></script>

    @Scripts.Render("~/bundles/openrequestlibraries")

    @Scripts.Render("~/bundles/openrequests")
    <script>
        $('.chkBox').each(function () {
            this.checked = false;
        });

        var clssCount = $('.chkBox').length;
        $(document).ready(function () {
            $(".checkAll").click(function () {
                $('.chkBox:checkbox').not(this).prop('checked', this.checked);
            });
        });

        //$('#BMorOthers tr').click(function () {
        //    var reqno = $(this).closest("tr").find('td:eq(1)').text();
        //    var region = $(this).closest("tr").find('#region').text();
        //    var bcode = $(this).closest("tr").find('#bcode').text();
        //    var zonecode = $(this).closest("tr").find('#zonecode').text();
        //    window.location.href = Url + '/request-details?ReqNo=' + reqno + '&BranchCode=' + bcode + '&ZoneCode=' + zonecode + '&Region=' + region;
        //    // Sample URL
        // http://localhost:61746/request-details?ReqNo=OR-HO-01P-0918-00019&BranchCode=001&ZoneCode=VISMIN&Region=PRESIDENT%20OFFICE&retUrl=head-office-open-requests
        //});

    </script>
}
