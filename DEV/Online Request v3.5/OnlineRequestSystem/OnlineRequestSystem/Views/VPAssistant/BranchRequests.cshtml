@model OnlineRequestSystem.Models.OpenReqInfo
@{
    ViewBag.Title = "VP";
    var mySession = (OnlineRequestSystem.Models.ORSession)Session["UserSession"];
}
<br />
<div class="jumbotron boxShadow col-md-12" style="width: 1300px; margin-left: -5.5%; padding-left: 0px; padding-right: 0px">
    <div class="panel-heading ORSHeading">
        <b>OPEN REQUESTS - BRANCHES </b>
    </div>
    <div>
        <div style="padding-top:7px;"></div>
        <table id="VPBranchRequests" class="table-hover table_data">
            <thead>
                <tr>
                    <th class="checkAll"><center><input type="checkbox" class="checkAll thChkbox"></center></th>
                    <th class="col-sm-1"><center>Select</center></th>
                    <th class="col-sm-1"><center>Date Created</center></th>
                    <th class="col-sm-2"><center>Request no.</center></th>
                    <th class="col-sm-2"><center>Types</center></th>
                    <th style="width:4%"><center>Count</center></th>
                    <th class="col-sm-1"><center>Price</center></th>
                    <th class="col-sm-1"><center>Description</center></th>
                    <th class="col-sm-2"><center>Branch/Division</center></th>
                    <th class="col-sm-2"><center>Author</center></th>
                    <th class="col-sm-2"><center>Region</center></th>
                </tr>
            </thead>

            <tbody style="font-size:12px;">
                @foreach (var item in Model._OpenInfo)
                {
                    if (item.reqAM == 1 && item.isApprovedAM == 1 && item.reqRM == 0)
                    {
                        <tr class="cellspacer">
                            @if (item.reqCreator == mySession.s_fullname)
                            {
                                <td><center>&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-user red"></span></center></td>
                            }
                            else
                            {
                                <td><center><input type="checkbox" class="chkBox" /></center></td>
                            }
                            <td><center><button class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber , BranchCode = item.BranchCode , ZoneCode = item.ZoneCode , Region = item.Region, retUrl = Model.returnUrl, office = Model.office})'">Show Details</button></center></td>
                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                            <td><center>@item.reqNumber</center></td>
                            <td><center>@item.TypeName</center></td>
                            <td><center>@item.TotalItems</center></td>
                            <td><center>@*@item.OverallTotalPrice*@</center></td>
                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                            <td><center>@item.BranchName</center></td>
                            <td><center>@item.reqCreator</center></td>
                            <td>
                                <center>
                                    @item.Region
                                    <span style="display:none;">@item.BranchCode</span>
                                </center>
                            </td>
                        </tr>
                    }
                    else if (item.reqAM == 1 && item.isApprovedAM == 1 && item.reqRM == 1 && item.isApprovedRM == 1)
                    {
                        <tr class="cellspacer">
                            @if (item.reqCreator == mySession.s_fullname)
                            {
                                <td><center>&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-user red"></span></center></td>
                            }
                            else
                            {
                                <td><center><input type="checkbox" class="chkBox" /></center></td>
                            }
                            <td><center><button class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber , BranchCode = item.BranchCode , ZoneCode = item.ZoneCode , Region = item.Region, retUrl = Model.returnUrl, office = Model.office})'">Show Details</button></center></td>
                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                            <td><center>@item.reqNumber</center></td>
                            <td><center>@item.TypeName</center></td>
                            <td><center>@item.TotalItems</center></td>
                            <td><center>@*@item.OverallTotalPrice*@</center></td>
                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                            <td><center>@item.BranchName</center></td>
                            <td><center>@item.reqCreator</center></td>
                            <td>
                                <center>
                                    @item.Region
                                    <span style="display:none;">@item.BranchCode</span>
                                </center>
                            </td>
                        </tr>
                    }
                    else if (item.reqAM == 0 && item.reqRM == 0)
                    {
                        <tr class="cellspacer">
                            @if (item.reqCreator == mySession.s_fullname)
                            {
                                <td><center>&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-user red"></span></center></td>
                            }
                            else
                            {
                                <td><center><input type="checkbox" class="chkBox" /></center></td>
                            }
                            <td><center><button class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber , BranchCode = item.BranchCode , ZoneCode = item.ZoneCode , Region = item.Region, retUrl = Model.returnUrl, office = Model.office})'">Show Details</button></center></td>
                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                            <td><center>@item.reqNumber</center></td>
                            <td><center>@item.TypeName</center></td>
                            <td><center>@item.TotalItems</center></td>
                            <td><center>@*@item.OverallTotalPrice*@</center></td>
                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                            <td><center>@item.BranchName</center></td>
                            <td><center>@item.reqCreator</center></td>
                            <td>
                                <center>
                                    @item.Region
                                    <span style="display:none;">@item.BranchCode</span>
                                </center>
                            </td>
                        </tr>
                    }

                }
            </tbody>
        </table>
        <input id="approver" type="text" value="VPAssistant" hidden />
        &nbsp;&nbsp;&nbsp;
        <button class="btn btn-sm btn-success" id="VPA_mApprove"><span class="glyphicon glyphicon-thumbs-up"></span> Approve</button>
        <button class="btn btn-sm btn-danger" id="btnMultiDisapprove"><span class="glyphicon glyphicon-thumbs-down"></span> Disapprove</button>
    </div>
</div>

@section tableCss{
    <link href="~/Content/dataTables.bootstrap4.min.css" rel="stylesheet" />
}

@section scripts{
    <script src="~/Scripts/table/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/table/dataTables.min.js"></script>
    <script src="~/Scripts/bootbox.min.js"></script>
    <script src="~/Scripts/MultiApproval/MultiApprove_VPassistant.js"></script>
    <script src="~/Scripts/MultiApproval/MultipleDisapprove.js"></script>
    <script>
        $('.chkBox').each(function () {
            this.checked = false;
        });

        $(".checkAll").click(function () {
            $('.chkBox:checkbox').not(this).prop('checked', this.checked);
        });

        $('#VPBranchRequests').DataTable({
            "order": [[2, "asc"]], "bSort": false, stateSave: true
        });

        $(".table_link").on("click", function () {
            $('#VPBranchRequests').DataTable().state.clear();
        });
    </script>
}