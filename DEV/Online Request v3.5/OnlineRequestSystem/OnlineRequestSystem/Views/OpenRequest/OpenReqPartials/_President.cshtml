@model OnlineRequestSystem.Models.OpenReqInfo
@{
    ViewBag.Title = "ViewOpenRequest";
    var mySession = (OnlineRequestSystem.Models.ORSession)Session["UserSession"];
}
<div style="padding-top:7px;"></div>

@if (Model.POurl == "PO")
{
    <table class="requests table-hover table_data" cellspacing="0">
        <thead>
            <tr>
                <th class="checkAll"><center><input type="checkbox" class="checkAll thChkbox"></center></th>
                <th style="text-align:center">Select</th>
                <th class="col-sm-1"><center>Date Created</center></th>
                <th class="col-sm-2"><center>Request no.</center></th>
                <th class="col-sm-2"><center>Types</center></th>
                <th style="width:6%;"><center>Count</center></th>
                <th class="col-sm-1"><center>Price</center></th>
                <th class="col-sm-1"><center>Description</center></th>
                <th class="col-sm-2"><center>Branch/Division</center></th>
                <th class="col-sm-2"><center>Author</center></th>
                <th class="col-sm-2"><center>Region</center></th>
                <th class="col-sm-1"><center>Post</center></th>
            </tr>
        </thead>
        <tbody style="font-size:12px;">
            @if (Model._OpenInfo != null)
            {
                foreach (var item in Model._OpenInfo)
                {
                    decimal price = string.IsNullOrEmpty(item.OverallTotalPrice) ? 0 : decimal.Parse(item.OverallTotalPrice);
                    string priceVal = price != 0 ? price.ToString("#,###,##0.00") : string.Empty;

                    if (item.MMD_Processed == 1)
                    {
                        if (item.reqStatus == "OPEN")
                        {
                            if (item.isDivRequest == "0")
                            {
                                if (item.reqAM == item.isApprovedAM && item.reqRM == item.isApprovedRM &&
                                item.reqDiv1 == item.isApprovedDiv1 && item.reqDiv2 == item.isApprovedDiv2 && item.reqDiv3 == item.isApprovedDiv3 &&
                                item.reqGM == item.isApprovedGM || item.reqCreator == mySession.s_fullname)
                                {
                                    if (item.reqPres == 1 && item.isApprovedPres == 0)
                                    {
                                        <tr class="cellspacer">
                                            @if (item.reqCreator == mySession.s_fullname)
                                            {
                                                <td><span class="glyphicon glyphicon-user red"></span></td>
                                            }
                                            else
                                            {
                                                <td><input type="checkbox" class="chkBox" /></td>
                                            }

                                            <td><center><button style="background-color: firebrick" class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber, BranchCode = item.BranchCode, ZoneCode = @item.ZoneCode, Region = @item.Region, retUrl = Model.returnUrl, PO = "PO" })'">Show Details</button></center></td>
                                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                                            <td><center>@item.reqNumber</center></td>
                                            <td title="@item.TypeName"><center>@item.TypeName</center></td>
                                            <td><center>@item.TotalItems</center></td>
                                            <td style="text-align:center">@priceVal</td>
                                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                                            <td><center>@item.BranchName</center></td>
                                            <td><center>@item.reqCreator</center></td>
                                            <td>
                                                <center>
                                                    @item.Region
                                                    <span style="display:none;">@item.BranchCode</span>
                                                </center>
                                            </td>
                                            <td>
                                                <center>
                                                    <div class="badge-holder">
                                                        <span class="glyphicon glyphicon-comment" style="font-size: 17px; color:grey"></span>
                                                        @if (item.numOfNotifs != 0)
                                                        {
                                                            <span class="badge badge-notify">@item.numOfNotifs</span>
                                                        }
                                                    </div>
                                                </center>
                                                <input type="hidden" class="ForPO" value="1" />
                                            </td>
                                        </tr>
                                    }

                                    else if (item.VPO_PO_Approved == 1 && item.Pres_PO_Approved == 0)
                                    {
                                        <tr class="cellspacer">
                                            @if (item.reqCreator == mySession.s_fullname)
                                            {
                                                <td><span class="glyphicon glyphicon-user red"></span></td>
                                            }
                                            else
                                            {
                                                <td><input type="checkbox" class="chkBox" /></td>
                                            }

                                            <td><center><button style="background-color: firebrick" class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber, BranchCode = item.BranchCode, ZoneCode = @item.ZoneCode, Region = @item.Region, retUrl = Model.returnUrl, PO = "PO" })'">Show Details</button></center></td>
                                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                                            <td><center>@item.reqNumber</center></td>
                                            <td title="@item.TypeName"><center>@item.TypeName</center></td>
                                            <td><center>@item.TotalItems</center></td>
                                            <td style="text-align:center">@priceVal</td>
                                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                                            <td><center>@item.BranchName</center></td>
                                            <td><center>@item.reqCreator</center></td>
                                            <td>
                                                <center>
                                                    @item.Region
                                                    <span style="display:none;">@item.BranchCode</span>
                                                </center>
                                            </td>
                                            <td>
                                                <center>
                                                    <div class="badge-holder">
                                                        <span class="glyphicon glyphicon-comment" style="font-size: 17px; color:grey"></span>
                                                        @if (item.numOfNotifs != 0)
                                                        {
                                                            <span class="badge badge-notify">@item.numOfNotifs</span>
                                                        }
                                                    </div>
                                                </center>
                                                <input type="hidden" class="ForPO" value="1" />
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                            else
                            {
                                if (item.isApprovedLocalDiv == 1 && item.isApprovedDM == 1 && item.reqDiv1 == item.isApprovedDiv1
                                    && item.reqDiv2 == item.isApprovedDiv2 && item.reqDiv3 == item.isApprovedDiv3
                                    || item.reqCreator == mySession.s_fullname)
                                {
                                    if (item.reqPres == 1 && item.isApprovedPres == 0 || item.reqCreator == mySession.s_fullname)
                                    {
                                        <tr class="cellspacer">
                                            @if (item.reqCreator == mySession.s_fullname)
                                            {
                                                <td><span class="glyphicon glyphicon-user red"></span></td>
                                            }
                                            else
                                            {
                                                <td><input type="checkbox" class="chkBox" /></td>
                                            }
                                            <td><center><button style="background-color: firebrick" class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber, BranchCode = item.BranchCode, ZoneCode = @item.ZoneCode, Region = @item.Region, retUrl = Model.returnUrl })'">Show Details</button></center></td>
                                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                                            <td><center>@item.reqNumber</center></td>
                                            <td title="@item.TypeName"><center>@item.TypeName</center></td>
                                            <td><center>@item.TotalItems</center></td>
                                            <td style="text-align:center">@priceVal</td>
                                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                                            <td><center>@item.BranchName</center></td>
                                            <td><center>@item.reqCreator</center></td>
                                            <td>
                                                <center>
                                                    @item.Region
                                                    <span style="display:none;">@item.BranchCode</span>
                                                </center>
                                            </td>
                                            <td>
                                                <center>
                                                    <div class="badge-holder">
                                                        <span class="glyphicon glyphicon-comment" style="font-size: 17px; color:grey"></span>
                                                        @if (item.numOfNotifs != 0)
                                                        {
                                                            <span class="badge badge-notify">@item.numOfNotifs</span>
                                                        }
                                                    </div>
                                                </center>
                                                <input type="hidden" class="ForPO" value="1" />
                                            </td>
                                        </tr>
                                    }

                                    else if (item.VPO_PO_Approved == 1 && item.Pres_PO_Approved == 0)
                                    {
                                        <tr class="cellspacer">
                                            @if (item.reqCreator == mySession.s_fullname)
                                            {
                                                <td><span class="glyphicon glyphicon-user red"></span></td>
                                            }
                                            else
                                            {
                                                <td><input type="checkbox" class="chkBox" /></td>
                                            }

                                            <td><center><button style="background-color: firebrick" class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber, BranchCode = item.BranchCode, ZoneCode = @item.ZoneCode, Region = @item.Region, retUrl = Model.returnUrl, PO = "PO" })'">Show Details</button></center></td>
                                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                                            <td><center>@item.reqNumber</center></td>
                                            <td title="@item.TypeName"><center>@item.TypeName</center></td>
                                            <td><center>@item.TotalItems</center></td>
                                            <td style="text-align:center">@priceVal</td>
                                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                                            <td><center>@item.BranchName</center></td>
                                            <td><center>@item.reqCreator</center></td>
                                            <td>
                                                <center>
                                                    @item.Region
                                                    <span style="display:none;">@item.BranchCode</span>
                                                </center>
                                            </td>
                                            <td>
                                                <center>
                                                    <div class="badge-holder">
                                                        <span class="glyphicon glyphicon-comment" style="font-size: 17px; color:grey"></span>
                                                        @if (item.numOfNotifs != 0)
                                                        {
                                                            <span class="badge badge-notify">@item.numOfNotifs</span>
                                                        }
                                                    </div>
                                                </center>
                                                <input type="hidden" class="ForPO" value="1" />
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                        }
                    }
                }
            }
        </tbody>
        <tfoot>
            <tr>
                <th>&nbsp;</th>
                <th class="col-sm-1">&nbsp;</th>
                <th class="col-sm-1">&nbsp;</th>
                <th class="col-sm-2">&nbsp;</th>
                <th class="col-sm-2">&nbsp;</th>
                <th><center>Total:</center></th>
                <th class="col-sm-1"></th>
                <th class="col-sm-1" style="width:10%">&nbsp;</th>
                <th class="col-sm-2">&nbsp;</th>
                <th class="col-sm-2">&nbsp;</th>
                <th class="col-sm-3">&nbsp;</th>
                <th class="col-sm-1">&nbsp;</th>
        </tfoot>
    </table>
}
else
{
    <table class="table-hover table_data" id="PresidentOpen" cellspacing="0">
        <thead>
            <tr>
                <th class="checkAll"><center><input type="checkbox" class="checkAll thChkbox"></center></th>
                <th style="text-align:center">Select</th>
                <th class="col-sm-1"><center>Date Created</center></th>
                <th class="col-sm-2"><center>Request no.</center></th>
                <th class="col-sm-2"><center>Types</center></th>
                <th style="width:6%;"><center>Count</center></th>
                <th class="col-sm-1"><center>Description</center></th>
                <th class="col-sm-2"><center>Branch/Division</center></th>
                <th class="col-sm-2"><center>Author</center></th>
                <th class="col-sm-2"><center>Region</center></th>
            </tr>
        </thead>
        <tbody style="font-size:12px;">
            @if (Model._OpenInfo != null)
            {
                foreach (var item in Model._OpenInfo)
                {
                    if (item.MMD_Processed != 1)
                    {
                        if (item.reqStatus == "OPEN")
                        {
                            if (item.isDivRequest == "0")
                            {
                                if (item.reqAM == item.isApprovedAM && item.reqRM == item.isApprovedRM &&
                                item.reqDiv1 == item.isApprovedDiv1 && item.reqDiv2 == item.isApprovedDiv2 && item.reqDiv3 == item.isApprovedDiv3 &&
                                item.reqGM == item.isApprovedGM || item.reqCreator == mySession.s_fullname)
                                {
                                    if (item.reqPres == 1 && item.isApprovedPres == 0)
                                    {
                                        <tr class="cellspacer">
                                            @if (item.reqCreator == mySession.s_fullname)
                                            {
                                                <td><span class="glyphicon glyphicon-user red"></span></td>
                                            }
                                            else
                                            {
                                                <td><input type="checkbox" class="chkBox" /></td>
                                            }

                                            <td><center><button class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber, BranchCode = item.BranchCode, ZoneCode = @item.ZoneCode, Region = @item.Region, retUrl = Model.returnUrl })'">Show Details</button></center></td>
                                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                                            <td><center>@item.reqNumber</center></td>
                                            <td title="@item.TypeName"><center>@item.TypeName</center></td>
                                            <td><center>@item.TotalItems</center></td>
                                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                                            <td><center>@item.BranchName</center></td>
                                            <td><center>@item.reqCreator</center></td>
                                            <td>
                                                <center>
                                                    @item.Region
                                                    <span style="display:none;">@item.BranchCode</span>
                                                </center>
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                            else
                            {
                                if (item.isApprovedLocalDiv == 1 && item.isApprovedDM == 1 && item.reqDiv1 == item.isApprovedDiv1
                                    && item.reqDiv2 == item.isApprovedDiv2 && item.reqDiv3 == item.isApprovedDiv3
                                    || item.reqCreator == mySession.s_fullname)
                                {
                                    if (item.reqPres == 1 && item.isApprovedPres == 0 || item.reqCreator == mySession.s_fullname)
                                    {
                                        <tr class="cellspacer">
                                            @if (item.reqCreator == mySession.s_fullname)
                                            {
                                                <td><span class="glyphicon glyphicon-user red"></span></td>
                                            }
                                            else
                                            {
                                                <td><input type="checkbox" class="chkBox" /></td>
                                            }
                                            <td><center><button class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber, BranchCode = item.BranchCode, ZoneCode = @item.ZoneCode, Region = @item.Region, retUrl = Model.returnUrl })'">Show Details</button></center></td>
                                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                                            <td><center>@item.reqNumber</center></td>
                                            <td title="@item.TypeName"><center>@item.TypeName</center></td>
                                            <td><center>@item.TotalItems</center></td>
                                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                                            <td><center>@item.BranchName</center></td>
                                            <td><center>@item.reqCreator</center></td>
                                            <td>
                                                <center>
                                                    @item.Region
                                                    <span style="display:none;">@item.BranchCode</span>
                                                </center>
                                            </td>
                                        </tr>
                                    }
                                    else if (item.forPresident == "1" && item.isApprovedPres == 0)
                                    {
                                        <tr class="cellspacer">
                                            @if (item.reqCreator == mySession.s_fullname)
                                            {
                                                <td><span class="glyphicon glyphicon-user red"></span></td>
                                            }
                                            else
                                            {
                                                <td><input type="checkbox" class="chkBox" /></td>
                                            }
                                            <td><center><button class="btn btn-sm btn-danger" onclick="location.href='@Url.Action("RequestDetails", "OpenRequest", new { ReqNo = item.reqNumber, BranchCode = item.BranchCode, ZoneCode = @item.ZoneCode, Region = @item.Region, retUrl = Model.returnUrl })'">Show Details</button></center></td>
                                            <td style="text-align:center" data-sort='@item.sortreqDate'>@item.reqDate</td>
                                            <td><center>@item.reqNumber</center></td>
                                            <td title="@item.TypeName"><center>@item.TypeName</center></td>
                                            <td><center>@item.TotalItems</center></td>
                                            <td><center>@item.itemDescription.ToString().Substring(0, (item.itemDescription.Length > 16) ? 16 : item.itemDescription.Length)</center></td>
                                            <td><center>@item.BranchName</center></td>
                                            <td><center>@item.reqCreator</center></td>
                                            <td>
                                                <center>
                                                    @item.Region
                                                    <span style="display:none;">@item.BranchCode</span>
                                                </center>
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                        }
                    }
                }
            }
        </tbody>
    </table>
}

<input id="approver" type="text" value="Pres" hidden />
&nbsp;&nbsp;&nbsp;
<div class="col-sm-3" @*style="position:absolute; bottom:20px"*@>
    <button class="btn btn-sm btn-success orHeader" id="Pres_mApprove"><i class="fa fa-check"></i> &nbsp;Approve</button>
    <button class="btn btn-sm btn-danger orHeader" id="btnMultiDisapprove"><i class="fa fa-times"></i> &nbsp;Disapprove</button>
</div>